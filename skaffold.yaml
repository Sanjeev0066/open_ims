apiVersion: skaffold/v4beta6
kind: Config

metadata:
  name: open-ims

profiles:
- name: dev
  activation:
    - command: dev
  manifests:
    kustomize:
      paths:
        - ./common/ingress/overlays/dev
        - ./common/pgadmin/overlays/dev
        - ./common/database/kustomize/overlays/dev
        - ./microservices/server/kustomize/overlays/dev
        - ./microservices/client/kustomize/overlays/dev
  build:
    local:
      push: false
    # tagPolicy:
    #   gitCommit: 
    #     prefix: "dev-"
    artifacts:
      - image: fcabrera01/open-ims-client-dev
        context: microservices/client
        docker:
          dockerfile: Dockerfile.dev
        sync:
          manual:
            - src: "src/**/*.js"
              dest: .
            - src: "src/**/*.ts"
              dest: .
            - src: "src/**/*.tsx"
              dest: .
            - src: "src/**/*.css"
              dest: .
            - src: "vite.config.ts"
              dest: .
            - src: "src/**/*.html"
              dest: .
      - image: fcabrera01/open-ims-server-dev
        context: microservices/server
        docker:
          dockerfile: Dockerfile.dev
        sync:
          manual:
            - src: "**/*.js"
              dest: .
            - src: "**/*.ts"
              dest: .
            - src: "tsconfig.json"
              dest: .
      
# TODO
- name: staging
  manifests:
    kustomize:
      paths:
        - ./common/database/kustomize/overlays/staging
        - ./common/ingress/kustomize/overlays/staging
        - ./microservices/server/kustomize/overlays/staging
        - ./microservices/client/kustomize/overlays/staging
  build:
    # tagPolicy:
    #   gitCommit: 
    #     prefix: "staging-"
    # local:
    #   push: false
    artifacts:
      - image: fcabrera01/open-ims-client-staging
        context: microservices/client
        docker:
          dockerfile: Dockerfile
      - image: fcabrera01/open-ims-server-staging
        context: microservices/server
        docker:
          dockerfile: Dockerfile
      # - image: fcabrera01/integration-testing
      #   context: common/testing
  # verify:
  #   - name: alpine-wget
  #     container:
  #       name: alpine-wget
  #       image: alpine:3.15.4
  #       command: ["/bin/sh"]
  #       args: ["-c", "wget http://localhost/api/server/testmsg"]